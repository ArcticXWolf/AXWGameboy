<!DOCTYPE html>
<html>

<head>
  <title>AXWGameboy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
  <div id="settings">
    <h1>AXWGameboy</h1>
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <form id="romLoader">
      <label for="romData" id="romDataLabel">Load ROM from File</label>
      <input type="file" name="romData" id="romData" onchange="handleROM(this.files[0])" />
    </form>
    <h2>Settings</h2>
    <form id="settingsHandler">
      <div class="checkboxSettings">
        <input type="checkbox" checked="checked" name="settingsSoundEnabled" id="settingsSoundEnabled" />
        <label for="settingsSoundEnabled">Toggle Sound</label>
      </div>
      <div class="checkboxSettings">
        <input type="checkbox" checked="checked" name="settingsOsbEnabled" id="settingsOsbEnabled" />
        <label for="settingsOsbEnabled">Toggle OnScreenButtons</label>
      </div>
      <h2>Cheatcodes</h2>
      <div class="cheatcodes">
        <textarea id="cheatcodesTextArea"></textarea>
      </div>
    </form>
    <h2>Keybindings for PC</h2>
    <div class="keybindings">
      <table>
        <thead>
          <tr>
            <th>Key</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><kbd>Y</kbd>/<kbd>Z</kbd></td>
            <td>A button</td>
          </tr>
          <tr>
            <td><kbd>X</kbd></td>
            <td>B button</td>
          </tr>
          <tr>
            <td><kbd>Space</kbd></td>
            <td>Start button</td>
          </tr>
          <tr>
            <td><kbd>LeftAlt</kbd></td>
            <td>Select button</td>
          </tr>
          <tr>
            <td><kbd>←</kbd> <kbd>↑</kbd> <kbd>↓</kbd> <kbd>→</kbd></td>
            <td>Arrow buttons</td>
          </tr>
          <tr>
            <td><kbd>LeftShift</kbd></td>
            <td>Speedboost (3x Speed)</td>
          </tr>
          <tr>
            <td><kbd>P</kbd></td>
            <td>Pause game</td>
          </tr>
          <tr>
            <td><kbd>Escape</kbd></td>
            <td>Close emulator</td>
          </tr>
          <tr>
            <td><kbd>+</kbd></td>
            <td>Increase volume</td>
          </tr>
          <tr>
            <td><kbd>-</kbd></td>
            <td>Decrease volume</td>
          </tr>
          <tr>
            <td><kbd>1</kbd></td>
            <td>Toggle sound channel 1</td>
          </tr>
          <tr>
            <td><kbd>2</kbd></td>
            <td>Toggle sound channel 2</td>
          </tr>
          <tr>
            <td><kbd>3</kbd></td>
            <td>Toggle sound channel 3</td>
          </tr>
          <tr>
            <td><kbd>4</kbd></td>
            <td>Toggle sound channel 4</td>
          </tr>
          <tr>
            <td><kbd>d</kbd></td>
            <td>Pause execution and enter debug mode in console</td>
          </tr>
          <tr>
            <td><kbd>t</kbd></td>
            <td>Toggle tilemap0</td>
          </tr>
          <tr>
            <td><kbd>Z</kbd>/<kbd>Y</kbd></td>
            <td>Toggle tilemap1</td>
        </tbody>
      </table>
    </div>
  </div>
  <div id="menuToggle" onclick="openNav()">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <iframe src="gameframe.html" id="game" scrolling="no" allow="autoplay"></iframe>
  <script>
    /* Open the sidenav */
    function openNav() {
      document.getElementById("settings").style.width = "100%";
    }

    /* Close/hide the sidenav */
    function closeNav() {
      document.getElementById("settings").style.width = "0";
    }

    gameboy = document.getElementById("game").contentWindow;
    function handleROM(file) {
      const reader = new FileReader();
      reader.onload = () => {
        soundEnabled = document.getElementById("settingsSoundEnabled").checked
        osbEnabled = document.getElementById("settingsOsbEnabled").checked
        gameboy.postMessage({ type: "loadRom", data: reader.result, settings: { soundEnabled: soundEnabled, osbEnabled: osbEnabled } }, "*");
        closeNav();
      };
      reader.readAsBinaryString(file);
    };

    document.getElementById("settingsHandler").addEventListener("change", function () {
      soundEnabled = document.getElementById("settingsSoundEnabled").checked;
      osbEnabled = document.getElementById("settingsOsbEnabled").checked;
      cheats = document.getElementById("cheatcodesTextArea").value;
      gameboy.postMessage({ type: "changeSettings", settings: { soundEnabled: soundEnabled, osbEnabled: osbEnabled, cheats: cheats } }, "*");
    });
  </script>
</body>

</html>